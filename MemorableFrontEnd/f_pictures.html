<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="apple-mobile-web-app-capable" content="yes" /> 
    <meta name="apple-touch-fullscreen" content="yes" />

    <link rel="shortcut icon" href="img/icon.jpg">
    <title>Memorable</title>

    

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/3-col-portfolio.css" rel="stylesheet">

    <!-- Memorable CSS -->
    <link href="css/memorable.css" rel="stylesheet">

    <!-- Slick Slider JS -->
    <link rel="stylesheet" type="text/css" href="js/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="js/slick/slick-theme.css"/>   
                
</head>

<body>

    <!-- Header -->
    <div class="memorable-header">
        <img src="img/logo.png" class="header-logo">
    </div>

    <!-- Page Content -->
    <div class="container family-screensize">

        <!-- Go Back -->
        <img src="img/backButton.png" class="back-button" onclick="backButton()">

<!--     <a href="f_profile.html">
        <img src="img/backButton.png" class="back-button">
    </a> -->

        <!-- Page Header -->
        <div class="edit-title-row">
            <div class="col-sm-2">
                <img class="edit-user-pic img-responsive" id="profileImg" alt="">
            </div>
            <div class="col-sm-10">
                <div id="editUserTitle" class="edit-user-title">
                </div>
            </div>
        </div>
        <!-- /.row -->



        <!-- Interests Row -->
        <div class="interests-row">
            <div class="favtitle-row">
                <h3 class="fav-title">Select Interests
                </h3>
            </div>
            <div class="interests">
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_piano.jpg" alt="" id="piano" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_farms.jpg" alt="" id="farm" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_golf.jpg" alt="" id="golf" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_beach.jpg" alt="" id="beach" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_dog.jpg" alt="" id="dog" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-md-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_football.jpg" alt="" id="football" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_flowers.jpg" alt="" id="flowers" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_horse.jpg" alt="" id="horse" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_garden.jpg" alt="" id="garden" onclick="interestHighlight(this.id)">
                </div>
                <div class="col-sm-2">
                    <img class="interest img-responsive" src="img/fakeInterests/s_tennis.jpg" alt="" id="tennis" onclick="interestHighlight(this.id)">
                </div>
            </div> 
        </div>
        <!-- /.row -->


        <!-- Fake Back & Next Buttons -->
        <img src="img/slick_back.png" class="fake-back-button-int" onclick="slideBack()">
        <img src="img/slick_next.png" class="fake-next-button-int" onclick="slideNext()">


        <!-- Personal Photos Row-->
        <div class="personal-photos-row">
            <div class="favtitle-row">
                <h3 class="fav-title">Photos</h3>
            </div>
            <div class="personal-table row">
                <div class="personal-row col-sm-12">
                    <div class="col-sm-15">

						<!-- upload image button -->
						<input type="image" src="img/tempUpload.jpg" alt="" class="personal-image img-responsive" onclick="chooseFile();"
							data-toggle="modal" data-target="#myModal" />
						
						<!-- upload image modal -->
						<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
							<div class="modal-dialog" style="width:330px"> <div class="modal-content"> 
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="myModalLabel">Upload a Photo</h4>
								</div>
								<form id="uploadForm" enctype="multipart/form-data" >
									<div class="modal-body">
										<input class="choose-pic" type="file" accept="image/*" id="files" name="files[]"
													onchange="loadFile(event)" />
										<br/> <img class="personal-image img-responsive" style="width: 300px" id="output"/>
										<br/> <p> Enter a message or caption for the picture: </p>
										<textarea type="text" id="caption" rows="2" style="resize: vertical; width:100%" ></textarea> 
									</div>
									<div class="modal-footer" style="text-align:center;">
										<input class="save-pic btn btn-default" type="submit" id="submit" ></input>					
									</div>
								</form>								
							</div> </div>						
						</div>
						<script>
						   function chooseFile() {
							  $("#files").click();							  
						   }
						</script>
						<script>
						  var loadFile = function(event) {
							var output = document.getElementById('output');
							output.src = URL.createObjectURL(event.target.files[0]);
						  };
						</script>						
                    </div>
					
					<!-- ============================================================================ -->
					<!-- ========= @Reggie: Translate to javascript to load for every image ========= -->
					<!-- ============================================================================ -->
					
					<div class="col-sm-15">
						<div class="img-wrap" style="position: relative">
							<span class="close" style="position: absolute; top: 2px; right: 8px; text-align: center" onclick="delImage();"
								data-toggle="modal" data-target="#deleteModal">&nbsp;&times;</span>
							<img class="personal-image img-responsive" src="images/reggie.jpg" id="1"/>
						</div>
						<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
							<div class="modal-dialog" style="width:330px"> <div class="modal-content"> 
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="myModalLabel">Confirm Delete</h4>
								</div>
								<form id="uploadForm" enctype="multipart/form-data" >
									<div class="modal-body">
										<br/> <p> Are you sure you would like to delete this photo? </p>
										<br/> <img class="personal-image img-responsive" style="width: 300px" id="delimg"/>
									</div>
									<div class="modal-footer" style="text-align:center;">
										<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
										<a class="btn btn-danger btn-ok">Delete</a>					
									</div>
								</form>								
							</div> </div>						
						</div>
						<!-- display image in modal -->
						<script>
							function delImage() {
								var img = document.getElementById('1');
								var delimg = document.getElementById('delimg');
								delimg.src = img.src;
							}
						</script>
					</div>
					
					<!-- ============================================================================ -->
					<!-- ============================================================================ -->
					<!-- ============================================================================ -->
					
                </div>
        </div>
        </div>
        <!-- /.row -->

    </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="js/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="js/slick/slick.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){
          $('.interests').slick({
            infinite: true,
            slidesToShow: 5,
            slidesToScroll: 5,
            arrows:false,
            speed:800
          });

        });
    </script>

    <style>
        .selectedInterest {
            border: solid #B689BC 5px;
        }
    </style>

    <script>
        function interestHighlight(id) {
            var docID = "#" + id;
            if($(docID).hasClass("selectedInterest")) {
                $(docID).removeClass("selectedInterest");

                // remove from db
                var uid = '1';
                $.post('/removeInterest/' + uid + '/' + id, function(data) {
                    console.log("removed interest");
                }); 

            } else {
                $(docID).addClass("selectedInterest");

                // add to db
                var uid = '1';
                $.post('/addInterest/' + uid + '/' + id, function(data) {
                    console.log("added interest");
                }); 
            }
        }
    </script>

    <script>
        function slideNext() {
            $('.interests').slick('slickNext');
        }
        function slideBack() {
            $('.interests').slick('slickPrev');
        }

    </script>

<script>
  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object

    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<li id="img_', i,  '"><strong>', escape(f.name), '</strong></li>');
    }
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>

 <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>

 <!--
 <div class="img-wrap">
    <span class="close">&times;</span>
    <img src="http://lorempixel.com/100/80">
</div>
 -->
 
 <script>
	function buildImg(fileName) {
		 var outterDiv = $('<div></div>')
		 outterDiv.attr('class', 'col-sm-15')
		 var innerDiv = $('<div></div>'))
		 innerDiv.attr('class', 'img-wrap')
		 var wrap = !('<span></span>')
		 wrap.attr('class', 'close')
		 wrap.innerHTML = "&times;"
		 var image = $('<img>')
		 image.attr('class', 'personal-image img-responsive')
		 image.attr('src', '/uploads/' + fileName)
		 outterDiv.append(image)
		 return outterDiv
	}
	
	function appendPersonalImg(fileName) {
		var image = buildImg(fileName)
		
		//create a new row if needed
		if ($('.personal-row:last').children().length >= 5) {
			var newRow = $('<div></div>')
			newRow.attr('class', 'personal-row col-sm-12')
			image = newRow.append(image)
			$('.personal-row:last').parent().append(image)
		} else {
			$('.personal-row:last').append(image)
		}
	}


	$(document).ready(function() {
		$('#uploadForm').submit(function() {
			var path = $('#files').val()
			var fileName = path.substring(path.lastIndexOf('\\') + 1)
			var caption = $('#caption').val()
			var urll = '../upload/' + fileName + '/' + caption;
			console.log('this is the url')	
			console.log(urll)

			$(this).ajaxSubmit({
				url: urll, 
				method: 'POST',
				error: function(xhr) {
                   console.log("ERROR uploading file")
				},
				success: function(response) {
					console.log("suuuuuccccessssss")
					
					document.getElementById('uploadForm').reset()
					$('.close').click()
					
					//now display the image that was just uploaded
					appendPersonalImg(fileName)
				}
			});
			return false;
		});
	
		//get the pictures associated to this user and display them
		$.get('/pictures', function(data) {
			console.log(data)
			for (var i = 0; i < data.length; i++) {
				var fileName = data[i].file_name
				appendPersonalImg(fileName)	
			}
		});
	});
</script>

<script>
        $(document).ready(function() {
            var user_id = getCookie("username");
            var fname = getCookie("fname");
            var lname = getCookie("lname");
            var imgPath = "img/fakeUsers/" + user_id + ".jpg";
            $("#editUserTitle").html(fname + "'s Pictures");
            $("#profileImg").attr("src", imgPath);
            // highlight user's interests
            var uid = '1';

				// tiffany I commented this out because it was throwing a 404 and making this whole page unusable and I was working on something in this page
            $.get('/selectInterests/' + uid, function(data) {

                $.ajax({
                    success: function(response) {
                        for (var i=0; i<data.length; i++) {
                            loadHighlight(data[i]);
                        }
                    }
                });
            });     
       


			 function loadHighlight(id) {
				  var docID = "#" + id;
				  if($(docID).hasClass("selectedInterest")) {
						$(docID).removeClass("selectedInterest");
				  } else {
						$(docID).addClass("selectedInterest");
				  }
			 }

			 function backButton() {
				  window.location = "f_profile.html"; 
			 }

			 function getCookie(cname) {
				  var name = cname + "=";
				  var ca = document.cookie.split(';');
				  for(var i=0; i<ca.length; i++) {
						var c = ca[i];
						while (c.charAt(0)==' ') c = c.substring(1);
						if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
				  }
				  return "";
			 }
	})
</script>

</body>
</html>
